name: Swift CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    name: Build and Test
    runs-on: macos-14
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Select Xcode
      run: sudo xcode-select -s /Applications/Xcode_15.2.app
    
    - name: Build Package
      run: swift build -v
    
    - name: Run Tests
      run: swift test -v
    
    - name: Check Swift Format
      run: |
        if command -v swift-format &> /dev/null; then
          swift-format lint --recursive Sources/
        else
          echo "swift-format not installed, skipping"
        fi

  compatibility:
    name: Platform Compatibility
    runs-on: macos-14
    strategy:
      matrix:
        platform: [iOS, macOS]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build for ${{ matrix.platform }}
      run: |
        if [ "${{ matrix.platform }}" == "iOS" ]; then
          xcodebuild -scheme luxeUI -destination 'platform=iOS Simulator,name=iPhone 15 Pro' build
        else
          swift build
        fi
